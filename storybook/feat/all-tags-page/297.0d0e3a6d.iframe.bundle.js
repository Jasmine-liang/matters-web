"use strict";(self.webpackChunkmatters_web=self.webpackChunkmatters_web||[]).push([[297],{"./src/common/utils/connections.ts":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>mergeConnections});var _home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/defineProperty.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_defineProperty_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_defineProperty_js__WEBPACK_IMPORTED_MODULE_0__),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1__),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/@babel/runtime/helpers/objectWithoutProperties.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2__),lodash_get__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/lodash/get.js"),lodash_get__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(lodash_get__WEBPACK_IMPORTED_MODULE_3__),lodash_set__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/lodash/set.js"),lodash_set__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(lodash_set__WEBPACK_IMPORTED_MODULE_4__),lodash_uniqBy__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/lodash/uniqBy.js"),lodash_uniqBy__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(lodash_uniqBy__WEBPACK_IMPORTED_MODULE_5__),_excluded=["edges","pageInfo"];function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);enumerableOnly&&(symbols=symbols.filter((function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable}))),keys.push.apply(keys,symbols)}return keys}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{};i%2?ownKeys(Object(source),!0).forEach((function(key){_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_defineProperty_js__WEBPACK_IMPORTED_MODULE_0___default()(target,key,source[key])})):Object.getOwnPropertyDescriptors?Object.defineProperties(target,Object.getOwnPropertyDescriptors(source)):ownKeys(Object(source)).forEach((function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key))}))}return target}var mergeConnections=function mergeConnections(_ref){var oldData=_ref.oldData,newData=_ref.newData,path=_ref.path,_ref$dedupe=_ref.dedupe,dedupe=void 0!==_ref$dedupe&&_ref$dedupe;try{var _get2=lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(oldData,path),oldEdges=_get2.edges,oldPageInfo=_get2.pageInfo,rest=_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_objectWithoutProperties_js__WEBPACK_IMPORTED_MODULE_2___default()(_get2,_excluded),_get3=lodash_get__WEBPACK_IMPORTED_MODULE_3___default()(newData,path),newEdges=_get3.edges,newPageInfo=_get3.pageInfo,result=oldData;if(newPageInfo.endCursor!==oldPageInfo.endCursor){var copy=JSON.parse(JSON.stringify(result)),edges=dedupe?lodash_uniqBy__WEBPACK_IMPORTED_MODULE_5___default()([].concat(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1___default()(oldEdges),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1___default()(newEdges)),(function(edge){return edge.node.id})):[].concat(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1___default()(oldEdges),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_1___default()(newEdges));return lodash_set__WEBPACK_IMPORTED_MODULE_4___default()(copy,path,_objectSpread(_objectSpread({},rest),{},{pageInfo:newPageInfo,edges}))}return result}catch(err){return console.error("Cannot get edges from path, skipping",err),oldData}}},"./src/components/Dialogs/DonatorsDialog/Content.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>Content});var _templateObject,styled_jsx=__webpack_require__("./node_modules/next/dist/shared/lib/styled-jsx.js"),styled_jsx_default=__webpack_require__.n(styled_jsx),react=__webpack_require__("./node_modules/react/index.js"),react_hooks_esm=__webpack_require__("./node_modules/@apollo/react-hooks/lib/react-hooks.esm.js"),useResponsive=__webpack_require__("./src/components/Hook/useResponsive.ts"),Spinner=__webpack_require__("./src/components/Spinner/index.tsx"),GQL_error=__webpack_require__("./src/components/GQL/error.tsx"),Dialog=__webpack_require__("./src/components/Dialog/index.tsx"),Translate=__webpack_require__("./src/components/Context/Language/Translate.tsx"),InfiniteList=__webpack_require__("./src/components/Interaction/InfiniteList/index.tsx"),UserDigest=__webpack_require__("./src/components/UserDigest/index.tsx"),analytics=__webpack_require__("./src/common/utils/analytics.ts"),connections=__webpack_require__("./src/common/utils/connections.ts"),taggedTemplateLiteral=__webpack_require__("./node_modules/@babel/runtime/helpers/taggedTemplateLiteral.js"),taggedTemplateLiteral_default=__webpack_require__.n(taggedTemplateLiteral),src=__webpack_require__("./node_modules/graphql-tag/src/index.js"),ARTICLE_DONATORS=__webpack_require__.n(src)()(_templateObject||(_templateObject=taggedTemplateLiteral_default()(["\n  query ArticleDonators($mediaHash: String!, $after: String) {\n    article(input: { mediaHash: $mediaHash }) {\n      id\n      donations: transactionsReceivedBy(\n        input: { first: 10, purpose: donation, after: $after }\n      ) {\n        totalCount\n        pageInfo {\n          startCursor\n          endCursor\n          hasNextPage\n        }\n        edges {\n          cursor\n          node {\n            ... on User {\n              id\n              ...UserDigestRichUserPublic\n              ...UserDigestRichUserPrivate\n            }\n          }\n        }\n      }\n    }\n  }\n  ","\n  ","\n"])),UserDigest.R.Rich.fragments.user.public,UserDigest.R.Rich.fragments.user.private),styles=[".container.jsx-568448146{display:inline-block;padding-top:0.5rem;padding-left:1rem;line-height:inherit;text-align:left;}",".avatar-list.jsx-568448146 .avatar{position:relative;border:2px solid #fff;}",".avatar-list.jsx-568448146 .avatar+.avatar{margin-left:-0.5rem;}",".avatar-list.jsx-568448146 .avatar:nth-child(1){z-index:5;}",".avatar-list.jsx-568448146 .avatar:nth-child(2){z-index:4;}",".avatar-list.jsx-568448146 .avatar:nth-child(3){z-index:3;}",".avatar-list.jsx-568448146 .avatar:nth-child(4){z-index:2;}",".avatar-list.jsx-568448146 .avatar:nth-child(5){z-index:1;}",".dialog-donator-list.jsx-568448146{padding:0.75rem 0;}"];styles.__hash="568448146";const DonatorsDialog_styles=styles;var __jsx=react.createElement;const Content=function DonatorsDialogContent(_ref){var _data$article,_data$article2,article=_ref.article,closeDialog=_ref.closeDialog,isSmallUp=(0,useResponsive.F)("sm-up"),_useQuery=(0,react_hooks_esm.aM)(ARTICLE_DONATORS,{variables:{mediaHash:article.mediaHash}}),data=_useQuery.data,loading=_useQuery.loading,error=_useQuery.error,fetchMore=_useQuery.fetchMore,_ref2=(null==data||null===(_data$article=data.article)||void 0===_data$article?void 0:_data$article.donations)||{},edges=_ref2.edges,pageInfo=_ref2.pageInfo;if(loading)return __jsx(Spinner.$,null);if(error)return __jsx(GQL_error.o,{error});if(!edges||edges.length<=0||!pageInfo)return null;var totalCount=(null==data||null===(_data$article2=data.article)||void 0===_data$article2?void 0:_data$article2.donations.totalCount)||0,defaultListMaxHeight=function calcContentMaxHeight(){if(window){return.01*window.innerHeight*90-16*(1.5+(isSmallUp?2.5:1.5)+1.5+1)}}();return __jsx(react.Fragment,null,__jsx(Dialog.V.Header,{title:__jsx(Translate.v,{zh_hant:"".concat(totalCount," 人支持了作品"),zh_hans:"".concat(totalCount," 人支持了作品")}),closeDialog,closeTextId:"close"}),__jsx(Dialog.V.Content,null,__jsx("div",{className:"jsx-".concat(DonatorsDialog_styles.__hash)+" dialog-donator-list"},__jsx(InfiniteList.$,{data:edges,defaultListMaxHeight,defaultRowHeight:70,loader:__jsx(Spinner.$,null),loadMore:function loadMore(callback){return analytics.c.trackEvent("load_more",{type:"donators",location:edges.length}),fetchMore({variables:{after:pageInfo.endCursor},updateQuery:function updateQuery(previousResult,_ref4){var fetchMoreResult=_ref4.fetchMoreResult;return callback(),(0,connections.k)({oldData:previousResult,newData:fetchMoreResult,path:"article.donations"})}})},renderer:function ListRow(_ref3){var index=_ref3.index,datum=_ref3.datum,node=datum.node,cursor=datum.cursor;return __jsx("div",{key:cursor,className:"jsx-".concat(DonatorsDialog_styles.__hash)+" donator-item"},node&&__jsx(UserDigest.R.Rich,{user:node,onClick:function onClick(){analytics.c.trackEvent("click_feed",{type:"donators",contentType:"user",location:index,id:node.id})}}),__jsx(styled_jsx_default(),{id:DonatorsDialog_styles.__hash},DonatorsDialog_styles))},totalCount})),__jsx(styled_jsx_default(),{id:DonatorsDialog_styles.__hash},DonatorsDialog_styles)))}},"./src/components/Interaction/InfiniteList/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{$:()=>InfiniteList});var _home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/@babel/runtime/helpers/toConsumableArray.js"),_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0___default=__webpack_require__.n(_home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0__),react__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/react/index.js"),react_virtualized__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/react-virtualized/dist/es/index.js"),__jsx=react__WEBPACK_IMPORTED_MODULE_1__.createElement,InfiniteList=function InfiniteList(_ref){var _window,data=_ref.data,loader=_ref.loader,loadMore=_ref.loadMore,renderer=_ref.renderer,totalCount=_ref.totalCount,_ref$defaultListHeigh=_ref.defaultListHeight,defaultListHeight=void 0===_ref$defaultListHeigh?10:_ref$defaultListHeigh,defaultListMaxHeight=_ref.defaultListMaxHeight,defaultRowHeight=_ref.defaultRowHeight,_ref$threshold=_ref.threshold,threshold=void 0===_ref$threshold?1:_ref$threshold,cache=new react_virtualized__WEBPACK_IMPORTED_MODULE_2__.t1({fixedWidth:!0,defaultHeight:defaultListHeight}),_useState=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(defaultRowHeight?defaultRowHeight*data.length:defaultListHeight),listHeight=_useState[0],setListHeight=_useState[1],maxHeight=(0,react__WEBPACK_IMPORTED_MODULE_1__.useState)(defaultListMaxHeight||(null===(_window=window)||void 0===_window?void 0:_window.innerHeight)||defaultListHeight)[0],rowRenderer=function rowRenderer(_ref4){var index=_ref4.index,key=_ref4.key,parent=_ref4.parent,style=_ref4.style,datum=data[index],props={cache,columnIndex:0,key,parent,rowIndex:index};return __jsx(react_virtualized__WEBPACK_IMPORTED_MODULE_2__.Z8,props,__jsx("div",{style},datum?renderer({index,datum}):loader))},onRowsHaveRendered=function onRowsHaveRendered(){if(listHeight<maxHeight){var current=function calculate(){return _home_runner_work_matters_web_matters_web_node_modules_babel_runtime_helpers_toConsumableArray_js__WEBPACK_IMPORTED_MODULE_0___default()(Array(data.length).keys()).reduce((function(sum,index){return sum+cache.getHeight(index,0)}),0)}();listHeight<current&&setListHeight(Math.min(maxHeight,current))}},count=(null==data?void 0:data.length)||0,rowCount=(totalCount||0)>count?count+1:count,listStyle={height:"".concat(Math.min(maxHeight,listHeight),"px")};return __jsx("div",{className:"infinite-list",style:listStyle},__jsx(react_virtualized__WEBPACK_IMPORTED_MODULE_2__.b2,{isRowLoaded:function isRowLoaded(_ref2){var index=_ref2.index;return!!data[index]},loadMoreRows:function loadMoreRows(_ref3){var startIndex=_ref3.startIndex;return loadMore((function(){return cache.clear(startIndex,0)}))},rowCount:totalCount,threshold},(function(_ref5){var _onRowsRendered=_ref5.onRowsRendered,registerChild=_ref5.registerChild;return __jsx(react_virtualized__WEBPACK_IMPORTED_MODULE_2__.qj,null,(function(_ref6){var width=_ref6.width,height=_ref6.height;return __jsx(react_virtualized__WEBPACK_IMPORTED_MODULE_2__.aV,{width,height,deferredMeasurementCache:cache,ref:registerChild,rowHeight:cache.rowHeight,rowRenderer,rowCount,onRowsRendered:function onRowsRendered(params){_onRowsRendered(params),onRowsHaveRendered()},overscanRowCount:0})}))})))}}}]);